# uncomment if you run a non bourne compatible shell. Ie. csh
#SHELL = @SH@

CC=@CC@
CFLAGS=@CFLAGS@ -fPIC
CPPFLAGS=-I. -I../include -I.. -I../../src @CPPFLAGS@ @DEFS@
AR=@AR@
RANLIB=@RANLIB@

.SUFFIXES: .lo

LIBSSH_OBJS=\
	fatal.o \
	ssherr.o \
	sshbuf.o \
	sshkey.o \
	sshbuf-getput-basic.o \
	sshbuf-misc.o \
	cipher.o cipher-ctr.o \
	xmalloc.o \
	poly1305.o chacha.o cipher-chachapoly.o \
	cipher-chachapoly-libcrypto.o digest-openssl.o

all: libopenssh.a

.c.o:
	$(CC) $(CPPFLAGS) $(CFLAGS) -c $< -o $@

$(LIBSSH_OBJS): ../../src/config.h

libopenssh.a: $(LIBSSH_OBJS)
	$(AR) rv $@ $(LIBSSH_OBJS)
	$(RANLIB) $@

clean:	
	rm -f *.o *.a

distclean: clean
	rm -f Makefile  *~

###################################
## Dependencies
###################################
depend: depend-rebuild
	rm -f .depend.bak

depend-rebuild:
	mv .depend .depend.old
	rm -f .depend
	touch ../../src/config.h .depend
	makedepend -w1000 -Y. -f .depend *.c 2>/dev/null
	(echo '# Automatically generated by makedepend.'; \
	 echo '# Run "make depend" to rebuild.'; sort .depend ) >.depend.tmp
	mv .depend.tmp .depend
	rm -f .depend.bak
	mv .depend.old .depend.bak

depend-check: depend-rebuild
	cmp .depend .depend.bak || (echo .depend stale && exit 1)

# @OPENSSH_DEPEND@
