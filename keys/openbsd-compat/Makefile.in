CC=@CC@
CFLAGS=@CFLAGS@ -fPIC
CPPFLAGS=-I. -I../include -I.. -I../../src @CPPFLAGS@ @DEFS@
AR=@AR@
RANLIB=@RANLIB@

OPENBSD=base64.o \
	bcrypt_pbkdf.o \
	blowfish.o \
	explicit_bzero.o \
	freezero.o \
	memmem.o \
	recallocarray.o \
	sha2.o \
	strsep.o \
	timingsafe_bcmp.o \


COMPAT=	bsd-malloc.o \
	bsd-misc.o \
	openssl-compat.o \
	libressl-api-compat.o

.c.o:
	$(CC) $(CPPFLAGS) $(CFLAGS) -c $<

all: libopenbsd-compat.a

$(COMPAT) $(OPENBSD): ../../src/config.h

libopenbsd-compat.a:  $(COMPAT) $(OPENBSD)
	$(AR) rv $@ $(COMPAT) $(OPENBSD)
	$(RANLIB) $@

clean:
	rm -f *.o *.a

distclean: clean
	rm -f Makefile *~

###################################
## Dependencies
###################################
depend: depend-rebuild
	rm -f .depend.bak

depend-rebuild:
	mv .depend .depend.old
	rm -f .depend
	touch ../../src/config.h .depend
	makedepend -w1000 -Y. -f .depend *.c 2>/dev/null
	(echo '# Automatically generated by makedepend.'; \
	 echo '# Run "make depend" to rebuild.'; sort .depend ) >.depend.tmp
	mv .depend.tmp .depend
	rm -f .depend.bak
	mv .depend.old .depend.bak

depend-check: depend-rebuild
	cmp .depend .depend.bak || (echo .depend stale && exit 1)

# @OPENBSD_COMPAT_DEPEND@
